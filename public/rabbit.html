<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Meta Rabbit Wallet - Z-OBTC</title>
<link rel="icon" href="logo.ico">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
  * { box-sizing: border-box; }
  body {
    margin:0; padding:0; background:#000; color:#fff;
    font-family:'Roboto',sans-serif; display:flex;
    flex-direction:column; align-items:center; min-height:100vh;
  }
  form.wallet {
    background:#141414; border-radius:16px; padding:30px 24px;
    width:95%; max-width:480px; margin:30px 0; box-shadow:0 0 12px #000;
  }
  .header{text-align:center;margin-bottom:24px;}
  .header h1{font-size:2rem;color:#00ff66;margin-bottom:10px;}
  .header img{width:80px;height:80px;object-fit:contain;}
  .input-box{background:#121212;border:2px solid #00ff66;border-radius:12px;padding:16px;margin-bottom:24px;}
  label{font-weight:bold;color:#00ff66;display:block;margin-bottom:6px;}
  select,input[type="text"],input[type="number"]{width:100%;padding:12px;border-radius:10px;background:#1e1e1e;border:none;color:#fff;font-size:1rem;}
  select:focus,input:focus{outline:2px solid #00ff66;background:#0d0d0d;}
  .btn{width:100%;background:#00ff66;color:#fff;border:none;border-radius:30px;padding:12px;font-weight:bold;cursor:pointer;transition:0.3s;margin-bottom:20px;}
  .btn:hover{background:#00cc55;}
  #output{background:#1a1a1a;color:#c0c0c0;font-family:monospace;font-size:0.95rem;padding:14px;border-radius:10px;margin-bottom:20px;white-space:pre-wrap;}
  #qrcode-stripe{margin:16px auto;width:220px;height:220px;}
  footer{margin-top:auto;padding:20px;color:#888;font-size:0.9rem;text-align:center;}
</style>
</head>
<body>

<form class="wallet" onsubmit="return false;">
  <div class="header">
    <h1>Meta Rabbit</h1>
    <img src="t.png" alt="Meta Rabbit Logo">
  </div>

  <div class="input-box">
    <label for="balance">Saldo Atual:</label>
    <input type="text" id="balance" readonly value="0 FRACTIO">
  </div>

  <div class="input-box">
    <label for="assetSelect">Selecione seu ativo:</label>
    <select id="assetSelect">
      <option value="">Selecione um ativo</option>
      <option value="Z-OBTC">Z-OBTC</option>
    </select>
  </div>

  <div class="input-box">
    <label for="valueInput">Valor por unidade (USD):</label>
    <input type="number" id="valueInput" placeholder="Digite o valor" min="1">
  </div>

  <div class="input-box">
    <label for="quantityInput">Quantidade de unidades:</label>
    <input type="number" id="quantityInput" placeholder="Digite a quantidade" min="1" value="1">
  </div>

  <button id="generateBtn" class="btn">Gerar QR Code</button>

  <div id="qrcode-stripe"></div>
  <div id="output"></div>
</form>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
(() => {
  const generateBtn = document.getElementById("generateBtn");
  const qrContainer = document.getElementById("qrcode-stripe");
  const output = document.getElementById("output");
  const assetSelect = document.getElementById("assetSelect");
  const valueInput = document.getElementById("valueInput");
  const quantityInput = document.getElementById("quantityInput");

  async function generateQR() {
    qrContainer.innerHTML = "";
    output.innerText = "";

    const value = parseFloat(valueInput.value);
    const quantity = parseInt(quantityInput.value) || 1;

    if (!value || value <= 0) return alert("‚ö†Ô∏è Valor inv√°lido.");
    if (quantity <= 0) return alert("‚ö†Ô∏è Quantidade inv√°lida.");
    if (!assetSelect.value) return alert("‚ö†Ô∏è Selecione um ativo.");

    try {
      const res = await fetch("/api/create-checkout-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ asset: assetSelect.value, value, quantity })
      });

      const data = await res.json();
      if (!res.ok) return alert(data.error || "Erro ao criar sess√£o Stripe.");

      const stripeURL = data.url;

      QRCode.toCanvas(stripeURL, { 
        width: 220, 
        color: { dark: "#00ff66", light: "#1c1c1c" } 
      }, (err, canvas) => {
        if (err) return console.error(err);
        qrContainer.appendChild(canvas);
      });

      output.innerText = `üì≤ QR Code Stripe gerado!
üí∞ Valor total: $${(value*quantity).toFixed(2)}
üîÅ Ativo: ${assetSelect.value}`;

    } catch (err) {
      console.error(err);
      alert("Erro de conex√£o com o servidor.");
    }
  }

  generateBtn.addEventListener("click", generateQR);
})();
</script>

<footer>Meta Rabbit ¬© 2025 BY LUCAS JANUARIO </footer>
</body>
</html>
